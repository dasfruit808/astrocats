<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro XP Anime Invaders</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@metaplex-foundation/js@0.20.1/dist/js/index.js"></script>
</head>
<body>
    <div class="xp-desktop">
        <div id="crt-frame" class="xp-window xp-primary-window">
            <div id="bezel-top" class="xp-titlebar">
                <div class="xp-title-group">
                    <span class="xp-title-icon">üê±‚ÄçüöÄ</span>
                    <div class="xp-title-text">
                        <span class="xp-app-name">Retro XP Anime Invaders</span>
                        <span class="xp-app-caption">Astrocats Arcade Cabinet</span>
                    </div>
                </div>
                <div class="xp-window-controls">
                    <button type="button" class="xp-control xp-min" id="window-show-desktop" title="Show Desktop">&#95;</button>
                    <button type="button" class="xp-control xp-max" id="window-open-hub" title="Open Player Hub">&#9633;</button>
                    <button type="button" class="xp-control xp-close" id="window-back-to-start" title="Back to Start">&#10005;</button>
                </div>
            </div>
            <div id="game-container">
            <canvas id="canvas" width="1280" height="720"></canvas>
            <div id="score">Score: 0</div>
            <div id="credits">Credits: 0</div>
            <div id="dash-cooldown">
                <div id="dash-bar"></div>
            </div>
            <div id="lives">Lives: 3</div>
            <div id="level">Level: 1</div>
            <div id="combo">Combo: 0</div>
            <div id="controls">
                <div>Use ‚Üê ‚Üí ‚Üë ‚Üì (or WASD) to Move | Double-Tap to Dash (2s CD)</div>
                <div>SPACE to Shoot (Hold for Charge)</div>
            </div>
            <div class="joystick" id="joystick">
                <div class="joystick-knob" id="knob"></div>
            </div>
            <div id="start-menu" class="overlay">
                <div class="menu-panel xp-window xp-modal">
                    <div class="xp-titlebar">
                        <div class="xp-title-group">
                            <span class="xp-title-icon">üöÄ</span>
                            <span class="xp-app-name">Start Menu</span>
                        </div>
                        <div class="xp-window-controls">
                            <button type="button" class="xp-control xp-close" id="start-menu-close" title="Close">&#10005;</button>
                        </div>
                    </div>
                    <div class="xp-window-content">
                        <h2>Welcome Pilot</h2>
                        <p class="xp-intro">Connect your wallet to sync progress or jump straight into the action.</p>
                        <button id="connect-wallet">Connect Phantom Wallet</button>
                        <p id="wallet-status">Not Connected</p>
                        <p id="nft-status">NFT Status: Not Detected</p>
                        <button id="play-btn">Play Game</button>
                    </div>
                </div>
            </div>

            <div id="hub" class="overlay">
                <div class="hub-panel xp-window xp-modal">
                    <div class="xp-titlebar">
                        <div class="xp-title-group">
                            <span class="xp-title-icon">üõ∞Ô∏è</span>
                            <span class="xp-app-name">Player Hub</span>
                        </div>
                        <div class="xp-window-controls">
                            <button type="button" class="xp-control xp-close" id="hub-close" title="Back to Start">&#10005;</button>
                        </div>
                    </div>
                    <div class="xp-window-content">
                        <div class="hub-header">
                            <h2>PLAYER HUB <span class="xp-subheading">Wallet: <span id="wallet-address">-</span></span></h2>
                            <button id="open-profile-modal" type="button">Create Pilot</button>
                        </div>

                        <div class="hub-overview">
                            <div class="pilot-card xp-card">
                                <div class="pilot-identity">
                                    <img id="pilot-avatar" src="https://placehold.co/80x80?text=Pilot" alt="Pilot avatar" loading="lazy" width="80" height="80" />
                                    <div class="pilot-identity-text">
                                        <span id="pilot-name-display">Rookie Pilot</span>
                                        <span id="pilot-title-display">Cadet</span>
                                    </div>
                                </div>
                                <p id="pilot-bio-display" class="pilot-bio">Set your pilot bio to share your legend.</p>
                            </div>

                            <div class="hub-summary">
                                <div class="summary-card xp-card">
                                    <h3>Mission Snapshot</h3>
                                    <div class="summary-grid">
                                        <div class="summary-stat">
                                            <span class="summary-label">Credits</span>
                                            <span class="summary-value" id="hub-credits">0</span>
                                        </div>
                                        <div class="summary-stat">
                                            <span class="summary-label">Level</span>
                                            <span class="summary-value" id="stat-level-hub">1</span>
                                        </div>
                                        <div class="summary-stat">
                                            <span class="summary-label">Best Score</span>
                                            <span class="summary-value" id="best-score">0</span>
                                        </div>
                                        <div class="summary-stat">
                                            <span class="summary-label">Active Sprite</span>
                                            <span class="summary-value" id="active-sprite">Astro Pioneer</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="hub-controls xp-card">
                                    <button id="open-stat-allocation">View Specialization Tree</button>
                                    <button id="hub-open-shop">Gacha Shop</button>
                                    <button id="hub-play-next">Play Next Round</button>
                                    <button id="hub-back-menu">Back to Menu</button>
                                </div>
                            </div>
                        </div>

                        <div id="profile-modal" class="profile-modal xp-window xp-modal" style="display: none;">
                            <div class="xp-titlebar">
                                <div class="xp-title-group">
                                    <span class="xp-title-icon">üßë‚ÄçüöÄ</span>
                                    <span class="xp-app-name">Pilot Profile</span>
                                </div>
                                <div class="xp-window-controls">
                                    <button type="button" class="xp-control xp-close" id="close-profile-modal" title="Close">&#10005;</button>
                                </div>
                            </div>
                            <div class="xp-window-content">
                                <form id="profile-form">
                                    <label for="profile-name">Pilot Name</label>
                                    <input id="profile-name" type="text" maxlength="40" placeholder="e.g., Nova" />

                                    <label for="profile-title">Title / Callsign</label>
                                    <input id="profile-title" type="text" maxlength="60" placeholder="e.g., Star Commander" />

                                    <label for="profile-avatar">Avatar Image URL</label>
                                    <input id="profile-avatar" type="text" placeholder="https://example.com/avatar.png" />

                                    <label for="profile-bio">Pilot Bio</label>
                                    <textarea id="profile-bio" rows="3" maxlength="280" placeholder="Share your origin story..."></textarea>

                                    <p id="profile-error" class="form-error" role="alert"></p>

                                    <div class="profile-actions">
                                        <button type="submit">Save Pilot</button>
                                        <button type="button" id="cancel-profile">Cancel</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="hub-content-grid">
                            <section class="xp-card">
                                <h3>Daily Missions</h3>
                                <div id="daily-quests" class="quest-list">
                                    <p>Loading missions...</p>
                                </div>
                            </section>

                            <section class="xp-card">
                                <h3>Resources &amp; Progression</h3>
                                <div class="resource-grid">
                                    <p>Pilot: <span id="pilot-name-stat">Rookie Pilot</span></p>
                                    <p>Callsign: <span id="pilot-title-stat">Cadet</span></p>
                                    <p>Items: <span id="items">-</span></p>
                                    <p>Spacecraft Owned: <span id="owned-sprites">Astro Pioneer</span></p>
                                </div>
                            </section>

                            <section class="xp-card">
                                <h3>Lifetime Stats</h3>
                                <div class="stat-grid">
                                    <p>Pilot: <span id="pilot-name-stats-panel">Rookie Pilot</span></p>
                                    <p>Callsign: <span id="pilot-title-stats-panel">Cadet</span></p>
                                    <p>Games Played: <span id="games-played">0</span></p>
                                    <p>Wins: <span id="wins">0</span></p>
                                    <p>Losses: <span id="losses">0</span></p>
                                    <p>&nbsp;</p>
                                </div>
                            </section>

                            <section class="xp-card">
                                <h3>Leaderboard</h3>
                                <div id="leaderboard">
                                    <p>No leaderboard data yet.</p>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
            <div id="shop" class="shop-overlay">
                <div class="shop-panel xp-window xp-modal">
                    <div class="xp-titlebar">
                        <div class="xp-title-group">
                            <span class="xp-title-icon">üé∞</span>
                            <span class="xp-app-name">Gacha Shop</span>
                        </div>
                        <div class="xp-window-controls">
                            <button type="button" class="xp-control xp-close" id="shop-close" title="Close Shop">&#10005;</button>
                        </div>
                    </div>
                    <div class="xp-window-content">
                        <p class="xp-balance">Credits Available: <span id="shop-credits">0</span></p>
                        <div id="shop-options">
                             <button id="shop-roll-basic">Basic Roll (50 Credits)</button>
                             <button id="shop-roll-premium">Premium Roll (200 Credits)</button>
                        </div>
                        <button id="shop-skip">Skip</button>
                    </div>
                </div>
            </div>
             <div id="stat-allocation" class="overlay">
                <div class="menu-panel xp-window xp-modal">
                    <div class="xp-titlebar">
                        <div class="xp-title-group">
                            <span class="xp-title-icon">üìä</span>
                            <span class="xp-app-name">Level Up</span>
                        </div>
                        <div class="xp-window-controls">
                            <button type="button" class="xp-control xp-close" id="stat-close" title="Return to Hub">&#10005;</button>
                        </div>
                    </div>
                    <div class="xp-window-content">
                        <p>Level: <span id="stat-level-overlay">1</span> | Specialization Points: <span id="stat-points">0</span></p>
                        <div id="stat-options"></div>
                        <button id="stat-return-hub">Return to HUB</button>
                    </div>
                </div>
            </div>
            <div id="wave-announce" class="announce">Wave Starting...</div>
            <div id="boss-announce" class="announce">Boss Incoming!</div>
        </div>
        <div id="bezel-bottom" class="xp-statusbar">
            <div class="xp-status-left">
                <span class="xp-status-label">System Status:</span>
                <span class="xp-status-value">Controls ready ¬∑ Use arrow keys or WASD</span>
            </div>
            <div class="xp-status-right">
                <span class="xp-status-tip">Press SPACE to fire ¬∑ Double-tap to dash</span>
            </div>
        </div>
        <div id="taskbar" class="xp-taskbar">
            <button class="xp-start-button" id="taskbar-start" type="button">
                <span class="xp-start-icon">üåü</span>
                <span class="xp-start-text">Start</span>
            </button>
            <div class="xp-task-buttons">
                <button type="button" class="xp-task-button" id="taskbar-open-hub">Player Hub</button>
                <button type="button" class="xp-task-button" id="taskbar-open-shop">Gacha Shop</button>
            </div>
            <div class="xp-task-clock" id="status-clock">--:--</div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>